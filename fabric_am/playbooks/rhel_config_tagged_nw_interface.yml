---
# file: rhel_config_tagged_nw_interface.yml

- hosts:
    - "{{ vmname }}"

  become: true

  tasks:
    - name: Determine the interface name identified by mac address
      set_fact:
        if_name: "{{ item }}"
      when:
        (item != 'lo')
        and
        (ansible_facts[item]['macaddress'] == mac )
      with_items:
        - "{{ ansible_interfaces }}"
    - include_role:
        name: linux-system-roles.network

  vars:
    network_connections:
      - name: "{{ if_name }}"
        type: ethernet
        autoconnect: yes
        ip:
          dhcp4: no
          auto6: no
        state: up
      - name: "{{ if_name }}.{{ vlan }}"
        type: vlan
        ip:
          dhcp4: no
          auto6: no
          address: "{{ address_list }}"
        vlan_id: "{{ vlan }}"
        parent: "{{ if_name }}"
        state: up